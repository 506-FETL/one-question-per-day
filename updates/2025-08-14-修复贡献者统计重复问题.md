# 修复贡献者统计重复问题

**更新时间**: 2025年8月14日  
**更新类型**: 修复问题  
**影响范围**: GitHub Actions 工作流、项目统计

## 问题描述

在 GitHub Actions 的 Release 工作流中，贡献者统计存在重复计算的问题：

- 同一个贡献者使用不同邮箱地址时被重复统计
- 同一个人的中英文姓名被视为不同贡献者
- 机器人账户（如 GitHub Action）被统计在内
- 镜像同步产生的账户被重复统计

导致贡献者数量从实际的 6 人被错误统计为 17 人。

## 解决方案

### 1. 创建 `.mailmap` 文件

新增 `.mailmap` 文件来合并相同身份的贡献者：

- 合并 `lll` 的多个邮箱地址
- 统一 `Gong Chen Yu` 和 `Gong Che Yu` 的拼写差异
- 合并 `彭畅` 和 `peng chang` 的中英文身份
- 整合其他贡献者的多个邮箱地址

### 2. 优化统计命令

将原来的简单统计命令：

```bash
git shortlog -sn --all | wc -l
```

优化为智能过滤命令：

```bash
git shortlog -sne --all | grep -v -E "(GitHub Action|action@github\.com|xier164.*gitee\.com)" | wc -l
```

### 3. 新增测试脚本

创建 `cmd/test-contributors.sh` 测试脚本，用于：

- 验证 mailmap 配置的正确性
- 测试贡献者统计逻辑
- 对比去重前后的统计结果
- 模拟 GitHub Actions 的统计过程

## 修改内容

### 新增文件

- `.mailmap` - Git 身份映射配置文件
- `cmd/test-contributors.sh` - 贡献者统计测试脚本

### 修改文件

- `.github/workflows/manual-release.yaml` - 更新贡献者统计逻辑

## 修复效果

- ✅ 贡献者统计从 17 人修正为 6 人
- ✅ 排除机器人和镜像同步账户
- ✅ 合并相同身份的重复统计
- ✅ 提供测试脚本验证统计准确性

## 技术细节

### mailmap 配置示例

```
# 合并 lll 的多个身份
lll <347552878@qq.com> lll <87215099+SeaMmMm@users.noreply.github.com>
lll <347552878@qq.com> lll <87215099+seaeam@users.noreply.github.com>

# 合并彭畅的中英文身份
彭畅 <1326278155@qq.com> peng chang <104177657+pcppp@users.noreply.github.com>
```

### 过滤规则

- 排除 `GitHub Action` 机器人账户
- 排除 `action@github.com` 邮箱
- 排除 `xier164.*gitee.com` 镜像同步账户

## 验证方法

运行测试脚本验证修复效果：

```bash
./cmd/test-contributors.sh
```

## 后续维护

- 当有新贡献者加入且出现身份重复时，需要更新 `.mailmap` 文件
- 如发现新的机器人账户，需要更新过滤规则
- 定期运行测试脚本确保统计准确性
