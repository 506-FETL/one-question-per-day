# Release 管理

## 手动 Release 功能

本项目配置了手动 Release 功能，适合多人协作环境，避免频繁的自动发布。

## 触发方式

### 🎯 仅支持手动触发

**为了适应多人协作环境，已禁用自动触发功能，只支持手动发布。**

#### GitHub Actions 手动触发

1. 访问项目的 **Actions** 页面
2. 选择 **"手动 Release"** 工作流
3. 点击 **"Run workflow"**
4. 配置发布参数：
   - **版本类型**: patch/minor/major
   - **自定义版本号**: 可选，格式 v1.2.3
   - **跳过测试**: 可选，用于紧急发布

#### 本地脚本发布

```bash
# 基础发布命令
pnpm release          # 交互式选择版本类型
pnpm release:patch    # 补丁版本 (v1.0.0 → v1.0.1)
pnpm release:minor    # 次要版本 (v1.0.0 → v1.1.0)
pnpm release:major    # 主要版本 (v1.0.0 → v2.0.0)
pnpm release:custom   # 自定义版本号
```

## 协作策略

### 👥 多人协作建议

1. **版本发布权限**: 建议指定专人负责版本发布
2. **发布时机**:
   - 完成重要功能时
   - 积累足够数量的题目时
   - 修复重要问题时
3. **发布前协调**: 团队成员确认当前代码稳定后再发布

## 版本规范

### 版本格式

```
v{major}.{minor}.{patch}
```

### 版本递增规则

- **major**: 重大功能更新、架构变更
- **minor**: 新功能、技术栈升级、批量题目更新
- **patch**: 小的改进、bug修复、少量题目更新

### 示例

```
v1.0.0 - 项目初始版本
v1.1.0 - 添加 TypeScript 支持
v1.1.1 - 修复 ESLint 配置问题
v1.2.0 - 新增10天题目
v2.0.0 - 重构项目架构
```

## Release 内容

每个 Release 会自动包含：

### 📝 更新内容

- 从 `updates/` 文件夹最新的更新文档生成
- 详细的功能变更说明

### 📊 项目统计

- 总题目数量
- 本次新增题目数量
- 贡献者统计

### 🛠️ 技术栈信息

- 当前使用的技术栈
- 开发工具配置

### 🚀 使用指南

- 项目安装步骤
- 常用命令说明

## CHANGELOG 自动更新

### ✅ 自动功能

**每次发布 Release 后，CHANGELOG.md 文件会自动更新**，无需手动维护：

1. **自动解析**: 从 `updates/` 文件夹中的最新更新文档自动提取内容
2. **智能分类**: 自动识别和分类以下内容：
   - 新增功能 (## 新增功能)
   - 修改内容 (## 修改内容)
   - 问题修复 (## 问题修复 或 ## 修复问题)
3. **格式规范**: 按照 [Keep a Changelog](https://keepachangelog.com/) 标准格式生成
4. **版本链接**: 自动生成版本对比链接

### 📋 更新文档格式要求

为了确保 CHANGELOG 自动更新正确，请在 `updates/` 文件夹中的更新文档使用以下格式：

```markdown
# 更新说明 - YYYY-MM-DD

## 新增功能

- ✅ 功能1描述
- ✅ 功能2描述

## 修改内容

- 📝 修改1描述
- 🔧 修改2描述

## 问题修复

- 🐛 修复1描述
- 🐛 修复2描述
```

### 🔄 更新流程

1. **手动发布**: 运行 `pnpm release` 时自动更新 CHANGELOG
2. **自动发布**: GitHub Actions 触发时自动更新
3. **智能提取**: 自动从最新的更新文档提取相关内容
4. **版本插入**: 在 `[未发布]` 区域下方插入新版本条目

### 🎯 演示功能

运行以下命令查看 CHANGELOG 自动更新的演示：

```bash
./scripts/demo-changelog.sh
```

### 🛠️ 技术栈信息

- 当前使用的技术栈
- 开发工具配置

### 🚀 使用指南

- 项目安装步骤
- 常用命令说明

## 手动创建 Release

如需手动创建 Release，可以使用以下命令：

```bash
# 1. 确保在 main 分支
git checkout main
git pull origin main

# 2. 创建并推送 tag
git tag -a v1.2.0 -m "Release v1.2.0: 新增功能描述"
git push origin v1.2.0

# 3. 在 GitHub 上创建 Release（或等待自动创建）
```

## 注意事项

1. **版本号一致性**: package.json 中的版本号会与 Git tag 保持同步
2. **更新文档**: 重要更新建议在 `updates/` 文件夹中添加详细说明
3. **测试通过**: Release 前确保所有测试通过
4. **分支保护**: main 分支应设置保护规则，要求 PR 才能合并

## 故障排查

### Release 未自动触发

1. 检查文件变更是否在监控路径内
2. 确认推送到了 main 分支
3. 查看 Actions 页面的错误日志

### 版本号冲突

1. 检查 Git tags 和 package.json 版本是否一致
2. 手动修复版本号后重新推送

### Release Notes 缺失

1. 确保 `updates/` 文件夹中有最新的更新文档
2. 检查文档格式是否正确
